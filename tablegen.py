from scipy.interpolate import interp1d
import math

from cal import setspeed


#whistle=1
#x = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250]
#y = [441.871567550608, 447.8089826961119, 469.5657572632926, 493.9287641224585, 519.9959006103716, 547.255044128559, 577.1238293486985, 609.101381795225, 643.5838943706001, 680.1581480856993, 721.958743747922, 760.9740909148586, 806.8384995516137, 856.2058440108283, 902.7950158358088, 956.1173980075876, 1013.5045565017058, 1063.0972034955003, 1116.4084608672374, 1164.3773219499024, 1215.2938345441628, 1255.2527330191324, 1295.7533024219629, 1327.528551241189, 1352.227963610546, 1367.1072581314957]

#whistle=2
#x = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250]
#y = [451.18337632326467, 460.20984576779836, 477.2685442669954, 503.0166248946491, 530.1530147423307, 560.4129948430348, 591.1443904901927, 624.5385560598481, 660.0064896878234, 698.2334404254431, 738.7268217262324, 780.1399619603499, 826.1216357547567, 874.853427880299, 929.0875573948658, 988.2757656693773, 1042.3442192819716, 1099.7765144118307, 1155.147325743948, 1211.466913149156, 1264.4471864752277, 1314.2171841411432, 1357.4185841592566, 1392.0099635704237, 1416.1784146315258, 1431.7553021430112]

#whistle=3
#x = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250]
#y = [446.2508890021676, 457.0283251598069, 475.5786750951537, 501.2863282265365, 528.1685999261088, 557.0889982036501, 584.6580717850015, 615.8319001849718, 651.0860247078722, 686.7830104775335, 725.1889440154464, 764.3680518484427, 809.312199188995, 857.2002022949323, 904.1778021800484, 953.5341279426104, 1007.5488547917864, 1059.825911025825, 1114.0978767614174, 1160.5361731149428, 1210.901696513757, 1252.6580384546826, 1294.983917829201, 1330.727908997309, 1355.2781910588046, 1373.4551777388233]

whistle=4
x = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250]
y = [451.9958351542622, 461.7027187052232, 481.3982376126602, 503.50310177991713, 533.3230961732753, 563.0690956475894, 592.2565162256736, 622.75467915798, 661.1058010738375, 698.0937954167089, 736.7402433230382, 779.0629936985392, 823.8467505840579, 877.1870587391845, 924.9559263615989, 975.6029383139264, 1032.8005083855378, 1086.1790586570633, 1139.0606785255359, 1192.6074682431076, 1238.6214944891908, 1284.4481205345792, 1324.0519780128707, 1359.5546531241753, 1388.764193313374, 1407.0926496379973]

f = interp1d(x, y, kind='cubic')


table=[]
n = 67.0
while (n<91):
  targetFreq = 440*math.pow(2, (n-69)/12.0 )

  print('\t', n, end='\r')

  if targetFreq <= y[0]:
    guess = 0
  elif targetFreq >= y[-1]:
    guess = x[-1]
  else:
    guess=0
    for k in range(0,251):
      error = abs(f(k)-targetFreq)
      if ( error < abs(f(guess)-targetFreq) ): guess=k
  table.append(guess)
  n+= 1/32.0

print("")

for angle in table:
  speed = setspeed(whistle, angle)
  print("{%d, %d}," % (speed, angle))

